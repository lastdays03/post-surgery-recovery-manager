# 🎯 통합 개인화 식단 관리 고도화 계획

본 문서는 온보딩 시 수집되는 기저질환, 알러지 및 사용자 특이 사항이 식단 생성 AI에 완벽히 반영되도록 하는 통합 개선 계획을 담고 있습니다.

## 1. 데이터 수집 및 정규화 로직 개선
사용자가 선택지 외의 정보를 입력했을 때 유연하게 대응할 수 있도록 모델을 개선합니다.

### 기저질환(`comorbidities`) 처리 로직
- **자동 분류 및 기타 저장**: AI가 답변을 분석할 때, 사전에 정의된 주요 질환(당뇨, 고혈압 등)에 해당하지 않는 경우 사용자가 입력한 텍스트 그대로를 '기타' 혹은 '직접 입력' 데이터로 유연하게 저장합니다.
- **알러지 필드 신설**: 식단 안전을 위해 기저질환과 별도로 `allergies: string[]` 필드를 추가하여 관리합니다.

## 2. 통합 데이터 흐름(Data Pipeline) 구축
수집된 파편화된 정보들을 식단 생성 API까지 유실 없이 전달합니다.

- **인터페이스 통합**: `lib/types/user.types.ts`를 기준으로 로컬 스토리지와 스토어의 데이터 규격을 일원화합니다.
- **API 연동**: `app/meal-plan/page.tsx`에서 식단 생성 요청 시, `comorbidities`와 `allergies` 정보를 `dietaryRestrictions` 및 `avoidIngredients` 필드로 통합하여 전달합니다.

## 3. AI 맞춤형 영양 가이드라인 강화
전달받은 정보를 바탕으로 AI가 실제 영양학적 제약을 적용하도록 합니다.

- **질환별 가이드라인**: 당뇨(저당), 고혈압(저나트륨), 담낭(저지방), 신장질환(단백질/칼륨 제한) 등 질환별 핵심 영양 제한 수치를 프롬프트에 내재화합니다.
- **안전 필터링**: 수집된 알러지 유발 원재료가 포함된 식단이 생성되지 않도록 엄격한 'Negative Constraint'를 적용합니다.

## 4. 사용자 직접 수정 및 확인 UI
AI가 이해한 정보가 올바른지 확인하고 사용자가 직접 보정할 수 있는 창구를 마련합니다.

- **최종 확인 단계**: 온보딩 완료 전, AI가 추출한 정보를 요약해서 보여주고 사용자가 '기타 주의사항' 등을 직접 수정/추가할 수 있는 Free-text 입력란을 제공합니다.

## 🔐 로그인 및 데이터 동기화 기능
기본적인 사용 편의성을 유지하면서도, 데이터 유실 방지와 멀티 디바이스 환경을 위한 인증 시스템을 구축합니다.

### 1. 비로그인 기반 하이브리드 모드
- **로컬 우선 정책**: 회원가입 없이도 브라우저 로컬 스토리지(`localStorage`)를 통해 모든 기능을 즉시 사용할 수 있도록 유지합니다.
- **초기 진입 장벽 제거**: 온보딩 및 식단 생성 과정을 로그인 없이 체험 가능하게 설계합니다.

### 2. 회원가입 및 데이터 마이그레이션
- **마이그레이션 로직**: 비로그인 상태에서 사용하던 로컬 데이터를 회원가입 및 로그인 시점에 사용자 계정(Supabase Auth/DB)으로 자동 통합(Sync)합니다.
- **소셜 로그인**: 사용 편의를 위해 Kakao, Google 등 소셜 로그인 연동 검토.

### 3. 멀티 디바이스 환경 최적화
- **실시간 동기화**: 로그인 후에는 모바일, PC 등 다른 환경에서도 동일한 회복 데이터와 식단 계획을 이어서 관리할 수 있도록 Supabase 실시간 연동 처리.
- **상태 관리**: 비로그인/로그인 상태에 따른 전역 상태(Zustand) 전환 로직 구현.
 
## 🧬 수술 생애주기 및 히스토리 관리 (Multi-Surgery Management)
단일 수술 관리를 넘어, 시간에 따른 다회 수술 기록 관리 및 새 수술 시작 기능을 지원합니다.

- **대시보드 내 '새 수술 추가' 기능**: 대시보드에서 새로운 수술명과 날짜를 입력하여 등록하는 UI 구현.
- **수술 기준점 전환 (Context Switch)**: 새 수술이 등록되면 식단 추천 엔진의 계산 기준(D-day)을 새 수술로 자동 전환하여 처음부터 관리 시작.
- **히스토리 격리 및 아카이브**: 이전 수술 기간의 식단 기록과 증상 로그를 연동된 수술 데이터와 함께 아카이브화. 사용자는 과거 수술 이력을 선택하여 당시의 기록을 확인할 수 있는 기능.

## 📊 데일리 컨디션 체크 고도화
사용자가 회복 상태를 더 다각도로 추적할 수 있도록 기록 항목을 확장합니다.

- **수면 패턴 기록**: `symptom-check` 페이지에 **수면 시작 시간 및 종료 시간** 입력 필드 추가. 이를 통해 총 수면 시간을 자동 계산하여 저장하고 수면의 질을 분석할 수 있는 기초 데이터로 활용.

## 🍽️ 식단 품질 및 미식(Gastronomy) 강화
수술 후 음식이 '단순한 영양 공급원'을 넘어 '먹는 즐거움'을 줄 수 있도록 AI 로직과 시각 요소를 강화합니다.

### 1. AI 조리 로직 고도화 (미식 가이드라인)
- **풍미 부스팅**: 자극적이지 않으면서 맛을 돋우는 '안전한 천연 조미료'(다시마 육수, 생강, 시나몬 등) 활용법을 프롬프트에 포함.
- **메뉴 명명법 개선**: 환자식 느낌의 이름(예: 소고기죽) 대신 식욕을 돋우는 명칭(예: 깊은 풍미의 한우 채소 미음)으로 생성 유도.
- **글로벌 회복식 도입**: 한국식 죽 외에도 이탈리아식 미네스트리나, 프랑스식 벨루테 등 세계 각국의 부드러운 회복식 레시피 데이터베이스 확장.

### 2. 시각적 경험 강화 (Visual Appeal)
- **AI 이미지 생성 연동**: 추천된 식단이 얼마나 맛있어 보이는지 시각적으로 보여주기 위해 DALL-E 등을 활용한 음식 이미지 생성 및 표시 기능.
- **플레이팅 팁**: 같은 환자식이라도 맛있게 보일 수 있는 간단한 플레이팅 가이드 제공.

---
*최종 업데이트 날짜: 2026-01-26*
